
\chapter{Merchant}
This thesis proposes a merchant software agent that can compete against competition on an online marketplaces.
The merchant makes ordering and pricing decisions with the goal to maximize the profit.
The merchant uses demand learning to estimate future customer demand from historical market situations and sales data.
The estimated demand is used in a dynamic programming approach to generate ordering and pricing policies.
%what is a policy?

We developed the merchant in four phases to overcome the complexity of this problem.
The first phase constrained the merchant's problem the most and only considers the inventory problem with known customer demand in a monopoly.
Each following phase adds a new difficulty for the merchant until the fourth phase which represents our final problem: The joint inventory and dynamic pricing problem with unknown customer behavior under competition.

Each of the following sections explains one phase in detail.
\todo{explain each ''step'' short in some sentences each with references to chapter} \cref{section:ordering}.
%explain structure of following sections

\section{Ordering}
\label{section:ordering}
In this scenario, the merchant cannot make pricing decisions.
Instead, all products are sold to a fixed price.
The merchant can focus on the ordering problem and make ordering decisions that promise the most expected long-term profit.
The merchant has a monopoly and does not have to care about any competitor.
Ordering decisions depend on the customer demand.
The demand is stochastic and its distribution is known to the merchant.
There are no backlogs. %sentence to short?
If a customer arrives when the merchant is out of stock, the merchant will miss the sale.

\subsection{Model Description}
%situation
%todo more intro/situation
The merchant wants to sell items on the marketplace.
% price & revenue
Items are offered at a fixed price $a_{fix}$ and each sold item generates a revenue of $a_{fix}$.
% time horizon
% write about t here?
The time horizon is infinite.
% discrete time
Since in real-life applications prices cannot be adjusted arbitrarily often, we use a discrete time
model.
%discounting
We use discounting to increase the relevance of short-term profits.
A discount factor $\delta$, $0 < \delta \leq 1$, is applied to each time period.

% inventory + holding cost
%todo introduce time and periods before that
The merchant holds items in an inventory.
The random inventory level at the start of period $t$ is denoted by $N_t$.
Storing items in the inventory causes holding costs of $l$ per item per time period. % l > 0

%ordering
The merchant can reorder items to increase the inventory level.
Order decisions, which can be made once each time period, will influence the merchant's profit.
The number of items ordered at time $t$ are denoted by $b_t$, with $b_t \geq 0$.
A order of size $b_t = 0$ means that no order is made.
%todo order delay
%set depends on time, yes? no?
The set of admissible orders quantities is denoted $B_t$.
% order cost
% explain fixed/variable order cost? explain somewhere else?
Each order causes a order cost, which consists of fixed order cost $c_{fix}$ and variable order cost $c_{var}$.
%order costs paid upfront
Order costs are defined by:

$$
C(b) := \begin{cases}
c_{fix} + c_{var} \cdot b  & \quad \text{if } b > 0 \\
0  & \quad \text{if } b = 0
\end{cases}
$$

%sales
The probability to sell $i$ items is denoted by $P(i)$.
%check: myopic somewhere mentioned and explained
Note, that the probability is time-independent because of the consumer's myopic buying behavior.
Additionally, the probability in this scenario is independent from offer prices because the merchants sells in a monopoly with a fixed price.
The random number of sold items within the period $(t-1, t)$ is denoted by $X_t$.
%check: backorders mentioned in previous section
%can I express the line below with random variables?
The merchant cannot sell more items than the inventory holds, i.e. $N_t \geq X_{t+1}$. % use specific n

%whats ordering strategy?
%how to write the policy?
Depending on a given ordering policy $(b_t)_t$, the random accumulated profit from time period $t$ is:

%can I do inf sum here? or switch to avg profit?
$$
G_t := \sum_{s=t+1}^{\infty} (\delta^{s-t} \cdot (a_{fix} \cdot X_s - l \cdot N_{s-1} - C(b_{s-1}(N_{s-1})))
$$

The objective is to find a ordering policy that maximizes the expected total profit $E(G_0 | N_0)$.

% end of model descripiton, maybe write what comes next
%Sales decrease the inventory level over time and orders increase it.

\subsection{Solution Approach}
%what? -> dyn programming
In this section, we want to derive optimal ordering policies.
% with and without delay
We use the dynamic programming approach to find the best expected profit of the stochastic control problem.
% is n defined?
The recursive value function $V_t(n)$ describes the best expected profit $E_t(G_t | N_t)$.
Since this this value function cannot be calculated over an infinite time horizon, we introduce the end time $T$ so that $t = 0, 1, 2, ..., T$.
If $T$ is sufficiently large, $V_t$ converged enough in order that the optimal ordering policy is not affected.
%V_T = 0

$N_{max}$ denotes the upper limit of the inventory level and the order decision, $0 \leq n, b \leq N_{max}$. This does not affect the optimal solution as long as $N_{max}$ is greater than the biggest inventory level that can occur in the optimal policy.

The value function is:
%where comes i from?
%make helper function clamp?
\begin{equation}
\begin{split}
V_t(n) = \max_{b \in B_t} \Bigg\{
	\sum_{i \geq 0} \Big(
		P(i) \cdot (
			a_{fix} \cdot min(i, n) %sales
			- l \cdot n % holding cost
			- C(b) % order cost
		) \\
		+ \delta \cdot V_{t+1}\big(min(max(n - i, 0) + b, N_{max}))\big)
	\Big)\Bigg\}
\end{split}
\label{eq:dyn_prog}
\end{equation}


\begin{equation}
\begin{split}
V_t(n) = \max_{b \in B_t} \Bigg\{
\sum_{i \geq 0} \Big(
P(i) \cdot (
a_{fix} \cdot min(i, n + b) %sales
- l \cdot (n + b) % holding cost
- C(b) % order cost
) \\
+ \delta \cdot V_{t+1}\big(min(max(n + b - i, 0), N_{max}))\big)
\Big)\Bigg\}
\end{split}
\label{eq:dyn_prog2}
\end{equation}

The set of order quantities must contain zero to allow to make no order.
The optimal ordering policy $b_t^*(n)$ is given by the arg max of \cref{eq:dyn_prog}. 

%why use dyn prog? -> optimal; why optimal?
% formula with without delayed order

\subsection{Evaluation}
%told, that this is a optimal ordering policy
%deviations from that should result in worse performance (profit)
%let's compare computed optimal policy in monopoly with policy that orders one item more(less)
%hint: use bigger dif if you cannot see difference in policies
\todo{compare with merchant that buys always one more / one less}

%konvergieren der wertefunktion
%vergleiche mit startwert 0, gleicher wert, zu hoher wert
%wie schnell konvergiert es (konvergiert es)? welchen einfluss hat der startwert?

\section{Joint Ordering and Pricing}
\subsection{Model Description}
%model from above gets extended by pricing decision
%define set of pricing decisions
\subsection{Solution Approach}
\subsection{Evaluation}

\section{Demand Learning}
\subsection{Model Description}
\subsection{Solution Approach}
\subsection{Evaluation}

\section{Competition}
%Zeige, dass zu langsam. Zeige, wie schneller gemacht wird
\subsection{Model Description}
\subsection{Solution Approach}
\subsection{Evaluation}
%verlgeiche genauen Wert mit relaxierten Wert

\section{Implementation}
%extra section for adaptive dynamic programming? -> runs in 0.1 sec